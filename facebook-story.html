<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facebook story</title>
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
    <style>
      body {
        margin: 0;
        background-color: black;
        padding: 0;

        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
      }
      .facebook {
        position: relative;
      }
      .item {
        width: 300px;
        height: 500px;
        display: none;
        overflow: hidden;
      }
      .item.is-active {
        display: block;
      }
      .item img,
      .item video {
        object-fit: cover;
        width: 100%;
        height: 100%;
      }
      .time-line {
        width: 100%;
        height: 10px;
        border-radius: 4px;
        display: flex;
        margin: 10px 0;
        gap: 5px;
      }
      .story {
        position: relative;
      }
      .story::before {
        content: url("/assets/icons8-play-50.png");
        display: none;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        position: absolute;
        top: 0;
        left: 0;
      }
      .story.pause::before {
        display: flex;
      }
      .line-wrap {
        background-color: grey;
        width: 100%;
        height: 100%;
        position: relative;
        border-radius: 4px;
      }
      .passed {
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        background-color: white;
        height: 100%;
        border-radius: 4px;
      }
      .passed.done {
        width: 100%;
      }

      .story-btn button:first-child {
        left: -70px;
        cursor: pointer;
        top: 50%;
        position: absolute;
        background-color: white;
        border: none;
        outline: none;
        padding: 20px;
        border-radius: 50%;
      }
      .story-btn button:last-child {
        right: -70px;
        border-radius: 50%;
        top: 50%;
        padding: 20px;

        border: none;
        outline: none;
        background-color: white;
        cursor: pointer;
        position: absolute;
      }

      @keyframes thumb {
        from {
          width: 0%;
        }
        to {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="facebook">
      <div class="wrapper"></div>
      <div class="story-btn">
        <button onclick="prevImage()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <button onclick="nextImage()">
          <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <script type="text/javascript">
      const storiesArr = [
        {
          id: 1,
          owner: "Thanh Minh",
          images: [
            {
              id: 1,
              src: "/assets/story1.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story2.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story3.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story4.jpeg",
              type: "img",
            },
          ],
        },
        {
          id: 2,
          owner: "Wendy",
          images: [
            {
              id: 1,
              src: "/assets/story5.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story6.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story7.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story8.jpeg",
              type: "img",
            },
            {
              id: 1,
              src: "/assets/story9.jpeg",
              type: "img",
            },
          ],
        },
        {
          id: 2,
          owner: "SeungWan",
          images: [
            {
              id: 1,
              src: "/assets/story10.mp4",
              type: "video",
            },
            {
              id: 1,
              src: "/assets/story11.mp4",
              type: "video",
            },
          ],
        },
      ];
      const wrapper = document.querySelector(".wrapper");
      let storyIndex = 0;
      let curIndex = 0;
      let itemInterval = 0;
      let runningState = true;
      let start;
      let remaining = 5000;

      function renderStory() {
        wrapper.innerHTML = `
      <div onclick="playAndPause()" class="story">
        <div class="time-line">
          ${storiesArr[storyIndex].images.map((item, index) => {
            return `
                  <div class="line-wrap ">
            <div class="line"></div>
            <div  class="passed ${index >= curIndex ? "" : "done"}"></div>
          </div>`;
          })}
        </div>
        <div class="slider">
            ${storiesArr[storyIndex].images.map((item, childIndex) => {
              return `
                <div class="item ${
                  curIndex === childIndex ? "is-active" : ""
                } ">
             ${
               item.type === "img"
                 ? `<img src="${item.src}" alt="" />`
                 : `
            <video  class="video" >
                <source src="${item.src}" type="video/mp4">
            </video> `
             }
          </div>`;
            })}

        </div>
      </div>`;
        if (storiesArr[storyIndex].images[curIndex].type === "video") {
          setTimeout(() => {
            storyRun();
          }, 3000);
        } else {
          storyRun();
        }
      }

      //on Mount
      renderStory();
      const lineWrap = document.querySelectorAll(".line-wrap");

      function storyRun() {
        if (storiesArr[storyIndex].images[curIndex].type === "video") {
          const video = document.querySelectorAll(".video");
          remaining = video[curIndex].duration * 1000;
          video[curIndex].play();
          const passed = document.querySelectorAll(".passed");
          passed[curIndex].style.animation = `thumb ${Math.round(
            remaining / 1000
          )}s linear`;

          start = Date.now();
          itemInterval = setTimeout(() => {
            nextImage();
          }, Math.round(remaining));
        } else {
          const passed = document.querySelectorAll(".passed");
          passed[curIndex].style.animation = `thumb ${Math.round(
            remaining / 1000
          )}s linear`;
          start = Date.now();
          itemInterval = setTimeout(() => {
            nextImage();
          }, Math.round(remaining));
        }
      }

      function playAndPause() {
        const passed = document.querySelectorAll(".passed");
        const story = document.querySelector(".story");
        clearTimeout(itemInterval);
        if (runningState) {
          if (storiesArr[storyIndex].images[curIndex].type === "video") {
            const video = document.querySelectorAll(".video");
            video[curIndex].pause();
          }
          story.classList.add("pause");
          remaining -= Date.now() - start;
          passed[curIndex].style.animationPlayState = "paused";
          runningState = false;
        } else {
          story.classList.remove("pause");
          if (storiesArr[storyIndex].images[curIndex].type === "video") {
            const video = document.querySelectorAll(".video");
            video[curIndex].play();
          }
          passed[curIndex].style.animationPlayState = "running";
          runningState = true;
          start = Date.now();
          storyRun();
        }
      }
      function nextImage() {
        if (
          storyIndex >= storiesArr.length - 1 &&
          curIndex >= storiesArr[storyIndex].images.length - 1
        ) {
          return;
        }
        remaining = 5000;
        clearInterval(itemInterval);
        if (curIndex >= storiesArr[storyIndex].images.length - 1) {
          storyIndex++;
          curIndex = 0;
          renderStory();
          return;
        }
        const image = document.querySelectorAll(".item");
        image[curIndex].classList.remove("is-active");
        image[curIndex + 1].classList.add("is-active");
        curIndex++;
        renderStory();
      }
      function prevImage() {
        if (storyIndex === 0 && curIndex === 0) {
          return;
        }
        remaining = 5000;
        clearInterval(itemInterval);
        if (curIndex === 0 && storyIndex > 0) {
          storyIndex--;
          curIndex = storiesArr[storyIndex].images.length - 1;
          renderStory();
          return;
        }
        const image = document.querySelectorAll(".item");
        image[curIndex].classList.remove("is-active");
        image[curIndex - 1].classList.add("is-active");
        curIndex--;
        renderStory();
      }
    </script>
  </body>
</html>
